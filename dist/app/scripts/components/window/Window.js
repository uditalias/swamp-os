define(["react","jsx!components/window/windowtitle/WindowTitle","jsx!components/window/windowmenu/WindowMenu","jsx!components/window/windowprompt/WindowPrompt","jsx!components/window/swamppluginwindowcontent/SwampPluginWindowContent","jsx!components/window/swampservicewindowcontent/SwampServiceWindowContent","constants/WINDOW_TYPE","constants/SERVICE_STATE","actions/client"],function(a,b,c,d,e,f,g,h,i){var j=a.createClass({displayName:"Window",getInitialState:function(){return{menuTree:this.props.descriptor.getMenuTree()}},componentDidMount:function(){this._setupWindowOptions(),$(this.getDOMNode()).on("mousedown",this._onMouseDown)},componentWillUnmount:function(){$(this.getDOMNode()).off("mousedown",this._onMouseDown),this._destroyWindowOptions(),this.props.descriptor=null},render:function(){var c="window flex flex-vbox ";c+=this.props.descriptor.getOptionsClasses().join(" ");var d=this._getIndicator(),e=this._getWindowPrompt(),f=this._getCover();return setTimeout(this._handleUIOptions,0),setTimeout(function(){$(this.getDOMNode()).addClass("in")}.bind(this),0),a.DOM.div({className:c,style:{zIndex:this.props.descriptor.getZindex(),top:this.props.descriptor.getPosition().top,left:this.props.descriptor.getPosition().left}},a.DOM.div({className:"window-title-wrapper"},b({indicator:d,isZoomed:this.props.descriptor.isZoomed(),onZoom:this._onZoomClick,onMinimize:this._onMinimizeClick,onClose:this._onCloseClick,maximizable:this.props.descriptor.isMaximizable(),minimizable:this.props.descriptor.isMinimizable(),text:this.props.descriptor.getTitle()})),a.DOM.div({className:(this.props.descriptor.isMinimized()?"hidden":"")+" flex flex-vbox flex-1"},a.DOM.div({className:"window-menu-wrapper"},this._getWindowMenu()),a.DOM.div({className:"flex-1 flex flex-vbox window-content-wrapper"},e,f,this._getWindowContent())))},_getWindowMenu:function(){return this.props.descriptor.hasMenu()?c({items:this.props.descriptor.getMenuTree()}):null},_getWindowContent:function(){switch(this.props.descriptor.getType()){case g.SERVICE:return f({service:this.props.descriptor.getPayload(),windowId:this.props.descriptor.id});case g.PLUGIN:return e({plugin:this.props.descriptor.getPayload(),onPluginRequest:this._onPluginRequest,windowId:this.props.descriptor.id})}},_onPluginRequest:function(a){if(a.name)switch(a.name){case"setMenuTree":this.props.descriptor.setMenuTree(a.payload),this.setState({menuTree:this.props.descriptor.getMenuTree()})}},_getCover:function(){return this.props.descriptor.getType()==g.PLUGIN?a.DOM.div({className:"spread cover",style:{display:this.props.descriptor.isFocused()?"none":"block"}}):null},_getIndicator:function(){switch(this.props.descriptor.getType()){case g.SERVICE:var a=this.props.descriptor.getPayload().state;return a==h.STOP?{color:"red"}:a==h.RUN?{color:"green"}:{color:"yellow"}}return null},_getWindowPrompt:function(){return this.props.descriptor.hasPrompt()?d({prompt:this.props.descriptor.getPrompt(),windowId:this.props.descriptor.id}):null},_destroyWindowOptions:function(){this.props.descriptor.isResizable()&&$(this.getDOMNode()).resizable("destroy"),this.props.descriptor.isDraggable()&&$(this.getDOMNode()).draggable("destroy")},_setupWindowOptions:function(){this.props.descriptor.isResizable()&&this._setupResize(),this.props.descriptor.isDraggable()&&this._setupDraggable(),$(this.getDOMNode()).css(this.props.descriptor.getPosition()),$(this.getDOMNode()).css(this.props.descriptor.getSize())},_setupResize:function(){var a=$(this.getDOMNode());a.resizable({containment:this.props.containerSelector,minWidth:this.props.descriptor.getMinWidth(),minHeight:this.props.descriptor.getMinHeight(),stop:this._onResizeEnd,start:this._onResizeStart}),a=null},_setupDraggable:function(){var a=$(this.getDOMNode());a.draggable({handle:".window-title-wrapper",cancel:".window-action",containment:this.props.containerSelector,scroll:!1,stop:this._onDragEnd,start:this._onDragStart}),a=null},_handleUIOptions:function(){var a=$(this.getDOMNode());this.props.descriptor.isZoomed()?(this.props.descriptor.isDraggable()&&a.draggable("disable"),this.props.descriptor.isResizable()&&a.resizable("disable")):(this.props.descriptor.isDraggable()&&a.draggable("enable"),this.props.descriptor.isResizable()&&a.resizable("enable")),this.props.descriptor.isMinimized()?this.props.descriptor.isResizable()&&a.resizable("disable"):this.props.descriptor.isResizable()&&!this.props.descriptor.isZoomed()&&a.resizable("enable"),a=null},_onResizeEnd:function(){$(this.getDOMNode()).find(".cover").hide()},_onResizeStart:function(){$(this.getDOMNode()).find(".cover").show()},_onDragEnd:function(){var a=$(this.getDOMNode()).position();this.props.descriptor.setPosition(a.top,a.left),$(this.getDOMNode()).find(".cover").hide()},_onDragStart:function(){$(this.getDOMNode()).find(".cover").show()},_onMouseDown:function(a){return a.stopPropagation(),a.preventDefault(),this.props.descriptor.isFocused()||i.focusWindow(this.props.descriptor.id),!1},_onCloseClick:function(){i.closeWindow(this.props.descriptor.id)},_onZoomClick:function(){this.props.descriptor.isMaximizable()&&i.zoomWindow(this.props.descriptor.id)},_onMinimizeClick:function(){this.props.descriptor.isMinimizable()&&i.minimizeWindow(this.props.descriptor.id)}});return j});