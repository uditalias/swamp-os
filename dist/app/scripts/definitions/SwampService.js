define(["EventEmitter","definitions/AggregatedData","constants/SERVICE_STATE","services/serializeService","constants/LOG_TYPE","constants/AGGREGATED_LIST_TYPE","moment","MD5","Identicon","pnglib"],function(a,b,c,d,e,f,g,h){function i(b){this.super=a,this.super(),this.id=b.id,this.name=b.name,this.description=b.description,this.path=b.path,this.script=b.script,this.isRunning=b.isRunning,this.runningEnvironment=b.runningEnvironment,this.selectedEnvironment=b.runningEnvironment,this.pid=b.pid,this.options=b.options,this.environments=b.environments,this.monitorCpu=b.monitor.cpu,this.monitorMemory=b.monitor.memory,this.monitor=b.monitor,this.state=this.isRunning?c.RUN:c.STOP,this.startTime=b.startTime,this._createMonitorDataContainers(),this._createLogDataContainers(this.options.maxLogsToSave),this._initializeLogs(b.logs),this._createAvatar()}return i.prototype=new a,i.prototype.setEnvironments=function(a){this.environments=a},i.prototype.setSelectedEnvironment=function(a){a in this.environments&&(this.selectedEnvironment=a)},i.prototype.updateMonitorData=function(a){this.monitor=a,isNaN(this.monitor.cpu)||this.cpuData.add({key:_.guid(),value:this.monitor.cpu}),isNaN(this.monitor.memory)||this.memoryData.add({key:_.guid(),value:this.monitor.memory})},i.prototype.forceStop=function(){this.pid=null,this.isRunning=!1,this.startTime=null,this.cpuData.clear(),this.memoryData.clear(),this.monitor.cpu=!1,this.monitor.memory=!1,this.state=c.STOP},i.prototype.forceStart=function(a){this._merge(a),this.state=c.RUN},i.prototype.forceRestart=function(){this.state=c.RESTART},i.prototype.log=function(a,b){var c=d.serializeLogData(a,b);switch(a){case e.OUT:this.outLogData.add(c);break;case e.ERROR:this.errorLogData.add(c)}},i.prototype.addOut=function(a){this.outLogData.add(a)},i.prototype.addError=function(a){this.errorLogData.add(a)},i.prototype.clearErrorLogs=function(){this.errorLogData.clear()},i.prototype.clearOutLogs=function(){this.outLogData.clear()},i.prototype.clearLogs=function(){this.clearErrorLogs(),this.clearOutLogs()},i.prototype.getContextMenu=function(){return{out_log:{callback:function(){}.bind(this)},error_log:{callback:function(){}.bind(this)},actions:{lineBefore:!0,items:{restart:{disabled:this.state!=c.RUN,callback:function(){this.emit("contextMenuRestart")}.bind(this)},start:{disabled:this.state!=c.STOP,callback:function(){this.emit("contextMenuStart")}.bind(this)},stop:{disabled:this.state!=c.RUN,callback:function(){this.emit("contextMenuStop")}.bind(this)},force_stop:{callback:function(){this.emit("contextMenuStop")}.bind(this)}}}}},i.prototype.dispose=function(){this.forceStop()},i.prototype._merge=function(a){_.assign(this,a)},i.prototype._createMonitorDataContainers=function(){this.cpuData=new b(f.FIFO,30),this.memoryData=new b(f.FIFO,30)},i.prototype._createLogDataContainers=function(a){this.outLogData=new b(f.FIFO,a),this.errorLogData=new b(f.FIFO,a)},i.prototype._initializeLogs=function(a){var b,c=this;a.err&&_.forEach(a.err,function(a){b=d.serializeLogData(e.ERROR,a),c.errorLogData.add(b)}),a.out&&_.forEach(a.out,function(a){b=d.serializeLogData(e.OUT,a),c.outLogData.add(b)})},i.prototype._createAvatar=function(){var a=h(this.name),b=new window.Identicon(a,150).toString();this.avatarBase64Url="data:image/png;base64,"+b},i});