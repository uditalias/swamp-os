define(["EventEmitter","definitions/SwampWindow"],function(a,b){function c(){this.super=a,this.super(),this._currentZindex=50,this._windowsRepository={},this._lastFocusId=null}var d="change";return c.prototype=new a,c.prototype.createWindow=function(a,c,d){var e=this.getWindowByTypeAndPayloadId(a,c.name);e||(e=new b(a,c,d),this.addWindow(e)),this.focusWindow(e.id)},c.prototype.addWindow=function(a){this._windowsRepository[a.id]?this.focusWindow(a.id):this._windowsRepository[a.id]=a},c.prototype.getWindowByTypeAndPayloadId=function(a,b){return _.filter(this._windowsRepository,function(c){return c.getType()==a&&c.getPayloadId()==b})[0]},c.prototype.getWindowById=function(a){return this._windowsRepository[a]},c.prototype.focusWindow=function(a){_.forEach(this._windowsRepository,function(b){b.isFocused()&&(this._lastFocusId=b.id),b.id!=a?b.blur():b.focus(this._currentZindex++)}.bind(this))},c.prototype.closeWindow=function(a){this._windowsRepository[a]=null,delete this._windowsRepository[a],this._lastFocusId&&this._windowsRepository[this._lastFocusId]?this.focusWindow(this._lastFocusId):this._lastFocusId=null},c.prototype.zoomWindow=function(a){var b=this.getWindowById(a);b&&b.toggleZoom()},c.prototype.minimizeWindow=function(a){var b=this.getWindowById(a);b&&b.toggleMinimize()},c.prototype.setWindowPrompt=function(a,b,c,d){var e=this.getWindowById(a);e&&e.setPrompt(b,c,d)},c.prototype.responseWindowPrompt=function(a,b){var c=this.getWindowById(a);c&&(b?c.confirmPrompt():c.cancelPrompt())},c.prototype.minimizeAllWindows=function(){_.forEach(this._windowsRepository,function(a){!a.isMinimized()&&a.isMinimizable()&&a.toggleMinimize()})},c.prototype.closeAllWindows=function(){_.forEach(this._windowsRepository,function(a){this.closeWindow(a.id)}.bind(this))},c.prototype.arrangeAllWindows=function(){var a=0,b=0,c=30,d=_.sortBy(this._windowsRepository,function(a){return a.getZindex()},this);_.forEach(d,function(d){a+=c,b+=c,d.setPosition(a,b)})},c.prototype.getAll=function(){return this._windowsRepository},c.prototype.emitChange=function(){this.emitEvent(d)},c.prototype.addChangeListener=function(a){this.on(d,a)},c.prototype.removeChangeListener=function(a){this.off(d,a)},c});